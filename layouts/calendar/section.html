{{ define "head" }}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.css" integrity="sha256-5veQuRbWaECuYxwap/IOE/DAwNxgm4ikX7nrgsqYp88=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
{{ end }}

{{ define "main" }}

<div class="container bg-light rounded p-2">
  <ul class="nav nav-tabs" role="tablist">
    {{ range $index, $item := .Site.Data.calendars.items }}
    <li class="nav-item" role="presentation">
      <button class="nav-link {{ if eq $index 0 }} active {{ end }}" data-bs-toggle="tab" type=button role="tab" onclick="renderCalendar('{{ .id }}')">
        {{ .name | safeHTML }}
      </button>
    </li>
    {{ end }}
  </ul>
  <div id='calendar' class=my-2>
  </div>
  <a id='nextcloud' target="_blank" class="btn btn-primary">In Nextcloud Ã¶ffnen</a>
  <button id='copyUrl' class="btn btn-primary" role="button")>
    iCalendar URL kopieren
  </button>
</div>

{{ end }}

{{ define "js" }}
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/main.min.js" integrity="sha256-XCdgoNaBjzkUaEJiauEq+85q/xi/2D4NcB3ZHwAapoM=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ical.js/1.5.0/ical.min.js" integrity="sha512-0izBc1upGYnrS1u1MX7QR+sjFIxZWxLVdNI7cUoHHCutDr5ENjuQRZuS+v+3NFNGfwHSrPoHzBzED0rV651tGw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdn.jsdelivr.net/npm/@fullcalendar/icalendar@5.11.0/main.global.min.js" integrity="sha256-ntXRERg+VVCcjXguw81eZystarWC9Tqx3mlgtLNgYVk=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.0/locales-all.min.js" integrity="sha256-GcByKJnun2NoPMzoBsuCb4O2MKiqJZLlHTw3PJeqSkI=" crossorigin="anonymous"></script>

<script>
  function renderCalendar(id) {
    var calendarEl = document.getElementById('calendar');
    var calendar = new FullCalendar.Calendar(calendarEl, {
      themeSystem: 'bootstrap5',
      locale: 'de',
      initialView: 'dayGridMonth',
      events: {
        url: "https://next.{{ $.Site.Params.baseDomain }}.org/remote.php/dav/public-calendars/" + id + "?export",
        format: "ics"
      },
      contentHeight: 600,
      headerToolbar: {
        left: 'prev next today',
        center: 'title',
        right: 'dayGridMonth,timeGridWeek,timeGridDay,listMonth'
      }
    });
    calendar.render();

    $('#copyUrl').click(function () {
      navigator.clipboard.writeText('webcal://next.{{ $.Site.Params.baseDomain }}.org/remote.php/dav/public-calendars/' + id + '/?export');
    });
    $('#nextcloud').attr('href', 'https://next.{{ $.Site.Params.baseDomain }}/apps/calendar/p/' + id);
  }

  document.addEventListener('DOMContentLoaded', function() {
    renderCalendar({{ (index .Site.Data.calendars.items 0).id }})
  });
</script>
{{ end }}
